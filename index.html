<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sovereign Cloud Compass v3.0 - BTC AG</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Password Overlay -->
    <div class="password-overlay" id="passwordOverlay">
        <div class="password-container">
            <div class="login-theme-toggle" onclick="toggleTheme()" role="button" aria-label="Toggle dark mode"></div>
            <img src="btc-logo.png" alt="BTC AG Logo" class="login-logo">
            <h2>Sovereign Cloud Compass</h2>
            <p class="subtitle">Wählen Sie Ihren Zugriffsmodus</p>

            <!-- Public Access First -->
            <div class="public-access-primary">
                <h3 class="access-title">Public Mode</h3>
                <p class="access-description">Nutzen Sie das Tool mit anonymisierten Anbietern</p>
                <button class="public-button" onclick="skipPassword()">
                    Ohne Passwort starten
                </button>
            </div>

            <div class="access-divider">
                <span>oder</span>
            </div>

            <!-- Password Access Below -->
            <div class="password-access-section">
                <h3 class="access-title">Vollzugriff</h3>
                <p class="access-description">Mit detaillierten Cloud-Anbieter-Namen</p>

                <form id="passwordForm" onsubmit="return false;">
                    <input
                        type="password"
                        class="password-input"
                        id="passwordInput"
                        placeholder="Passwort eingeben..."
                        autocomplete="off"
                    >
                    <button type="submit" class="password-button" onclick="checkPassword()">
                        Zugriff erhalten
                    </button>
                    <div class="password-error" id="passwordError">
                        Falsches Passwort. Bitte versuchen Sie es erneut.
                    </div>
                </form>

                <div class="password-cta-section">
                    <p class="password-cta">Noch kein Passwort?</p>
                    <a href="https://outlook.office.com/book/BTCAGManagedCloudServices@btcag.onmicrosoft.com/s/U1HPjhE9b0qdW-uTHThOSw2?ismsaljsauthenabled" target="_blank" class="password-cta-button">
                        Beratungstermin vereinbaren
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Navigation Overlay -->
    <div class="mobile-nav-overlay" id="mobileNavOverlay" onclick="closeMobileNav()"></div>

    <!-- Mobile Navigation Drawer -->
    <nav class="mobile-nav-drawer" id="mobileNavDrawer">
        <div class="drawer-header">
            <img src="btc-logo.png" alt="BTC AG Logo" class="drawer-logo">
            <div class="drawer-header-actions">
                <div class="theme-toggle" onclick="toggleTheme()" role="button" aria-label="Toggle dark mode"></div>
                <button class="drawer-close" onclick="closeMobileNav()" aria-label="Menü schließen">
                    &times;
                </button>
            </div>
        </div>
        <div class="drawer-content">
            <span class="drawer-section-label">Navigation</span>
            <a href="evaluation-criteria.html" class="drawer-nav-link">
                <i class="fas fa-clipboard-list"></i>
                Bewertungskriterien
            </a>
            <a href="https://btc-ag.github.io/SAA/" class="drawer-nav-link">
                <i class="fas fa-compass"></i>
                Architecture Advisor
            </a>
            <a href="https://www.btc-ag.com/download?g=whitepaper-cloud-compass" target="_blank" class="drawer-nav-link">
                <i class="fas fa-file-alt"></i>
                Whitepaper
            </a>
            <div class="drawer-divider"></div>
            <span class="drawer-section-label">Kontakt</span>
            <a href="https://outlook.office.com/book/BTCAGManagedCloudServices@btcag.onmicrosoft.com/s/U1HPjhE9b0qdW-uTHThOSw2?ismsaljsauthenabled" target="_blank" class="drawer-nav-link primary">
                <i class="fas fa-calendar-check"></i>
                Beratungstermin
            </a>
            <a href="https://www.btc-ag.com/digital-sovereignty" target="_blank" class="drawer-nav-link">
                <i class="fas fa-shield-alt"></i>
                Go Sovereign!
            </a>
        </div>
    </nav>

    <!-- Protected Content -->
    <div class="protected-content" id="protectedContent">
        <!-- Header -->
        <header class="header">
            <div class="container">
                <nav class="header-nav">
                    <a href="#" class="logo">
                        <img src="btc-logo.png" alt="BTC AG Logo" class="logo-img">
                    </a>
                    <div class="header-actions">
                        <!-- Desktop Navigation -->
                        <div class="desktop-nav">
                            <div class="theme-toggle" onclick="toggleTheme()" role="button" aria-label="Toggle dark mode"></div>
                            <a href="https://btc-ag.github.io/SAA/" class="btn btn-secondary">
                                Architecture Advisor
                            </a>
                            <a href="https://www.btc-ag.com/download?g=whitepaper-cloud-compass" target="_blank" class="btn btn-secondary">
                                Whitepaper
                            </a>
                            <a href="https://outlook.office.com/book/BTCAGManagedCloudServices@btcag.onmicrosoft.com/s/U1HPjhE9b0qdW-uTHThOSw2?ismsaljsauthenabled" target="_blank" class="btn btn-primary">
                                Beratung
                            </a>
                        </div>
                        <!-- Mobile Burger Menu Toggle -->
                        <button class="burger-menu-toggle" id="burgerMenuToggle" onclick="toggleMobileNav()" aria-label="Menü öffnen">
                            <span class="burger-icon">
                                <span class="burger-line"></span>
                                <span class="burger-line"></span>
                                <span class="burger-line"></span>
                            </span>
                        </button>
                    </div>
                </nav>
                <div class="access-mode-badge" id="accessBadge">
                    Public Access - Anonymisierte Ansicht
                </div>
                <h1 class="header-title">Sovereign Cloud Compass</h1>
                <p class="header-subtitle">Ihre intelligente Entscheidungshilfe für souveräne Cloud-Strategien</p>
            </div>
        </header>

        <!-- Main -->
        <main class="main">
            <div class="container">
                <!-- Info Banner -->
                <div class="info-banner">
                    <div class="info-banner-title">Bewertungsgrundlage</div>
                    <div class="info-banner-text">
                        Die Bewertungen basieren auf umfassenden Experten-Einschätzungen der BTC für jeden betrachteten Cloud-Provider.
                        Alle beteiligten Experten verfügen jeweils über mehr als 10 Jahre Beratungs-, Betriebs- und Service-Erfahrung mit
                        verschiedenen Cloud-Providern sowie geprüfte und vielfach zertifizierte Expertise in Cloud-Beratung und -Architektur.
                        <a href="evaluation-criteria.html" style="color: var(--btc-primary); text-decoration: underline; margin-left: 0.5rem;">
                            Mehr über die Bewertungskriterien →
                        </a>
                    </div>
                </div>

                <!-- Control Panel with Integrated Matrix -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Ihre Cloud-Strategie</h2>
                    </div>
                    <p class="card-description">
                        Digitale Souveränität ist kein Zufall – sie entsteht durch bewusste Entscheidungen. Verschieben Sie den Regler,
                        um die Balance zwischen Kontrolle und Leistungsfähigkeit zu bestimmen - je nach Ihrer Ausrichtung identifizieren
                        wir den optimalen Cloud-Ansatz. (Hinweis: Das SaaS-Portfolio der Cloud-Anbieter wurde in der Positionierung nicht berücksichtigt)
                    </p>
                </div>

                <!-- Matrix Container with Slider -->
                <div class="matrix-container">
                    <!-- Slider Section (Left) -->
                    <div class="slider-section">
                        <div class="slider-header">
                            <h3 class="slider-title">Strategie</h3>
                            <p class="slider-subtitle">Passen Sie die Balance zwischen Kontrolle und Leistung an</p>
                        </div>

                        <div class="slider-labels">
                            <div class="slider-label slider-label-control">
                                <span>Kontrolle</span>
                            </div>
                            <div class="slider-label slider-label-performance">
                                <span>Leistung</span>
                            </div>
                        </div>

                        <div class="slider-wrapper">
                            <div class="slider-track">
                                <input type="range" class="slider-input" id="strategySlider" min="0" max="100" value="50">
                                <div class="slider-thumb" id="sliderThumb"></div>
                            </div>
                        </div>

                        <div class="current-value-display">
                            <span id="valueDisplay">Ausgewogen (50:50)</span>
                        </div>

                        <!-- Category Filter -->
                        <div class="category-filter">
                            <div class="filter-title">Kategorien</div>
                            <div class="filter-options" id="categoryFilters">
                                <div class="filter-option" data-category="hyperscaler">
                                    <div class="filter-checkbox active">
                                        <svg class="filter-check" width="12" height="10" viewBox="0 0 12 10" fill="none">
                                            <path d="M1 5L4.5 8.5L11 1.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                    </div>
                                    <div class="filter-color" style="background: #ef4444;"></div>
                                    <div class="filter-label">
                                        <span class="filter-name">Hyperscaler</span>
                                        <span class="filter-count" id="count-hyperscaler">(4)</span>
                                    </div>
                                </div>
                                <div class="filter-option" data-category="sovereign">
                                    <div class="filter-checkbox active">
                                        <svg class="filter-check" width="12" height="10" viewBox="0 0 12 10" fill="none">
                                            <path d="M1 5L4.5 8.5L11 1.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                    </div>
                                    <div class="filter-color" style="background: #3b82f6;"></div>
                                    <div class="filter-label">
                                        <span class="filter-name">Souveräne Clouds</span>
                                        <span class="filter-count" id="count-sovereign">(2)</span>
                                    </div>
                                </div>
                                <div class="filter-option" data-category="eu">
                                    <div class="filter-checkbox active">
                                        <svg class="filter-check" width="12" height="10" viewBox="0 0 12 10" fill="none">
                                            <path d="M1 5L4.5 8.5L11 1.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                    </div>
                                    <div class="filter-color" style="background: #10b981;"></div>
                                    <div class="filter-label">
                                        <span class="filter-name">EU Anbieter</span>
                                        <span class="filter-count" id="count-eu">(3)</span>
                                    </div>
                                </div>
                                <div class="filter-option" data-category="private">
                                    <div class="filter-checkbox active">
                                        <svg class="filter-check" width="12" height="10" viewBox="0 0 12 10" fill="none">
                                            <path d="M1 5L4.5 8.5L11 1.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                    </div>
                                    <div class="filter-color" style="background: #8b5cf6;"></div>
                                    <div class="filter-label">
                                        <span class="filter-name">Private Cloud</span>
                                        <span class="filter-count" id="count-private">(2)</span>
                                    </div>
                                </div>
                                <div class="filter-option" data-category="hybrid">
                                    <div class="filter-checkbox active">
                                        <svg class="filter-check" width="12" height="10" viewBox="0 0 12 10" fill="none">
                                            <path d="M1 5L4.5 8.5L11 1.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                    </div>
                                    <div class="filter-color" style="background: #f59e0b;"></div>
                                    <div class="filter-label">
                                        <span class="filter-name">Hybrid-Lösungen</span>
                                        <span class="filter-count" id="count-hybrid">(3)</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Chart (Right) -->
                    <div class="chart-content">
                        <div class="chart-wrapper">
                            <div class="chart-title">
                                Cloud-Anbieter Matrix
                            </div>
                            <div class="chart-canvas" id="chartCanvas">
                                <div class="chart-axis chart-axis-x"></div>
                                <div class="chart-axis chart-axis-y"></div>
                                <div class="chart-label chart-label-x">Leistungsfähigkeit →</div>
                                <div class="chart-label chart-label-y">↑ Kontrolle</div>

                                <div class="quadrant-label quadrant-1">Souverän</div>
                                <div class="quadrant-label quadrant-2">Autarkiefokussiert</div>
                                <div class="quadrant-label quadrant-3">Starter</div>
                                <div class="quadrant-label quadrant-4">Leistungsfokussiert</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Results -->
                <div class="results-grid" id="resultsGrid"></div>

                <!-- Legend -->
                <div class="legend-card">
                    <div class="legend-title">Cloud-Anbieter Kategorien</div>
                    <div class="legend-grid" id="legendGrid"></div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <div class="container">
                <img src="btc-logo.png" alt="BTC AG Logo" class="footer-logo">
                <p class="footer-text">
                    Ihr Partner für souveräne Cloud-Transformation |
                    <a href="https://www.btc-ag.com/digital-sovereignty" class="footer-link">Mehr über Go Sovereign!</a> |
                    <a href="https://www.btc-ag.com/Impressum" class="footer-link">Impressum</a>
                </p>
                <span style="position: absolute; bottom: 0.5rem; right: 1rem; font-size: 0.7rem; color: var(--gray-400); opacity: 0.6;">Version 2.0.1</span>
            </div>
        </footer>
    </div>

    <script>
        // Theme Management
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        }

        // Initialize theme on load
        initTheme();

        // Mobile Navigation Management
        function toggleMobileNav() {
            const drawer = document.getElementById('mobileNavDrawer');
            const overlay = document.getElementById('mobileNavOverlay');
            const toggle = document.getElementById('burgerMenuToggle');

            const isOpen = drawer.classList.contains('open');

            if (isOpen) {
                closeMobileNav();
            } else {
                drawer.classList.add('open');
                overlay.classList.add('visible');
                toggle.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        }

        function closeMobileNav() {
            const drawer = document.getElementById('mobileNavDrawer');
            const overlay = document.getElementById('mobileNavOverlay');
            const toggle = document.getElementById('burgerMenuToggle');

            drawer.classList.remove('open');
            overlay.classList.remove('visible');
            toggle.classList.remove('active');
            document.body.style.overflow = '';
        }

        // Close mobile nav on escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeMobileNav();
            }
        });

        // Close mobile nav on window resize to desktop
        window.addEventListener('resize', () => {
            if (window.innerWidth > 992) {
                closeMobileNav();
            }
        });

        // Security Configuration
        const PASSWORD_HASH = '8d3a1838c96994fdc083afd45060f5cc1f72983e6a995daca367806584d9ea15';
        let isAuthenticated = false;

        // SHA-256 Hash Function
        async function sha256(message) {
            const msgBuffer = new TextEncoder().encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        // Check Session
        function checkSession() {
            const unlocked = sessionStorage.getItem('compassUnlocked');
            const isPublic = sessionStorage.getItem('compassPublic');

            if (unlocked === 'true') {
                isAuthenticated = true;
                unlockContent(false);
            } else if (isPublic === 'true') {
                isAuthenticated = false;
                unlockContent(true);
            }
        }

        // Check Password
        async function checkPassword() {
            const input = document.getElementById('passwordInput');
            const error = document.getElementById('passwordError');
            const enteredPassword = input.value;

            const enteredHash = await sha256(enteredPassword);

            if (enteredHash === PASSWORD_HASH) {
                sessionStorage.setItem('compassUnlocked', 'true');
                sessionStorage.removeItem('compassPublic');
                isAuthenticated = true;
                unlockContent(false);
                error.classList.remove('show');
            } else {
                error.classList.add('show');
                input.value = '';
                input.focus();
                setTimeout(() => error.classList.remove('show'), 3000);
            }
        }

        // Skip Password (Public Mode)
        function skipPassword() {
            sessionStorage.setItem('compassPublic', 'true');
            sessionStorage.removeItem('compassUnlocked');
            isAuthenticated = false;
            unlockContent(true);
        }

        // Unlock Content
        function unlockContent(isPublicMode) {
            document.getElementById('passwordOverlay').classList.add('hidden');
            document.getElementById('protectedContent').classList.add('unlocked');

            const badge = document.getElementById('accessBadge');
            if (isPublicMode) {
                badge.innerHTML = 'Public Access - Anonymisierte Ansicht';
                badge.style.background = 'var(--gray-100)';
                badge.style.borderColor = 'var(--gray-300)';
            } else {
                badge.innerHTML = 'Full Access - Vollständige Ansicht';
                badge.style.background = 'var(--gray-100)';
                badge.style.borderColor = 'var(--btc-primary)';
            }

            initializeCompass(isPublicMode);
        }

        // Load Custom Scores from LocalStorage
        function loadCustomScores() {
            try {
                const stored = localStorage.getItem('scc_custom_provider_scores');
                return stored ? JSON.parse(stored) : {};
            } catch (e) {
                console.error('Error loading custom scores:', e);
                return {};
            }
        }

        // Apply Custom Scores to Providers
        function applyCustomScores(providers) {
            const customScores = loadCustomScores();
            return providers.map(provider => {
                const providerKey = provider.name.toLowerCase().replace(/\s+/g, '-');
                const custom = customScores[providerKey];

                if (custom) {
                    return {
                        ...provider,
                        control: custom.control !== undefined ? custom.control : provider.control,
                        performance: custom.performance !== undefined ? custom.performance : provider.performance
                    };
                }
                return provider;
            });
        }

        // Cloud Provider Data
        const baseFullProviders = [
            { name: 'AWS', control: 42, performance: 95, color: '#ef4444', category: 'hyperscaler', groupIndex: 0,
              description: 'Umfangreichstes Portfolio an Infrastruktur- und Plattform-Services mit exzellenter Developer Experience.' },
            { name: 'Microsoft Azure', control: 42, performance: 95, color: '#ef4444', category: 'hyperscaler', groupIndex: 1,
              description: 'Leistungsfähiges Cloud-Ökosystem mit umfangreichem IaaS/PaaS-Portfolio und größter Partner-Landschaft.' },
            { name: 'Google Cloud', control: 42, performance: 95, color: '#ef4444', category: 'hyperscaler', groupIndex: 2,
              description: 'Überzeugend bei Container-Management, KI-Services und Workplace-Lösungen.' },
            { name: 'Oracle Cloud', control: 40, performance: 70, color: '#ef4444', category: 'hyperscaler',
              description: 'Besondere Stärken im Datenbank-Bereich mit umfangreichen Sicherheits- und Compliance-Möglichkeiten.' },
            { name: 'AWS European Sovereign Cloud', control: 80, performance: 90, color: '#3b82f6', category: 'sovereign',
              description: 'Auf hohe Überlebensfähigkeit in geopolitischen Krisen ausgerichtet mit voller europäischer Souveränität.' },
            { name: 'Microsoft DELOS Cloud', control: 85, performance: 65, color: '#3b82f6', category: 'sovereign',
              description: 'Speziell für deutsche Verwaltung mit vollständiger Datenhoheit ohne US-Zugriffsmöglichkeiten.' },
            { name: 'STACKIT', control: 90, performance: 75, color: '#10b981', category: 'eu',
              description: 'Cloud-Lösung der Schwarz Gruppe mit Fokus auf deutsche Mittelständler.' },
            { name: 'IONOS Cloud', control: 65, performance: 65, color: '#10b981', category: 'eu',
              description: 'Größter deutscher Cloud-Anbieter mit DSGVO-konformer Infrastruktur.' },
            { name: 'Open Telekom Cloud', control: 55, performance: 55, color: '#10b981', category: 'eu',
              description: 'Deutsche Telekom Cloud basierend auf OpenStack für regulierte Branchen.' },
            { name: 'OpenStack Private Cloud', control: 100, performance: 35, color: '#8b5cf6', category: 'private',
              description: 'Open-Source Private Cloud mit voller Transparenz und ohne Vendor-Lock-in.' },
            { name: 'VMware Private Cloud', control: 85, performance: 20, color: '#8b5cf6', category: 'private',
              description: 'Bewährte Enterprise-Virtualisierung mit voller Kontrolle.' },
            { name: 'Google Dedicated Cloud', control: 85, performance: 70, color: '#f59e0b', category: 'hybrid',
              description: 'Vollständig isolierte Google Cloud ohne Internetverbindung für höchste Sicherheit.' },
            { name: 'Azure Stack HCI', control: 55, performance: 60, color: '#f59e0b', category: 'hybrid',
              description: 'Hybrid-Cloud-Lösung mit Azure-Services on-premises.' },
            { name: 'AWS Outpost', control: 50, performance: 65, color: '#f59e0b', category: 'hybrid',
              description: 'AWS-Services in Ihrem Rechenzentrum für konsistente Hybrid-Erfahrung.' }
        ];

        // Apply custom scores
        const fullProviders = applyCustomScores(baseFullProviders);

        const anonymousProviders = fullProviders.map((p, i) => {
            let prefix = '';
            if (p.category === 'hyperscaler') prefix = 'H';
            else if (p.category === 'sovereign') prefix = 'S';
            else if (p.category === 'eu') prefix = 'E';
            else if (p.category === 'private') prefix = 'P';
            else if (p.category === 'hybrid') prefix = 'Y';

            const index = fullProviders.filter((fp, fi) => fi <= i && fp.category === p.category).length;

            return { ...p, name: `${prefix}${index}` };
        });

        const legendData = {
            full: [
                { color: '#ef4444', text: '<strong>Hyperscaler</strong> (AWS, Azure, GCP, Oracle)' },
                { color: '#3b82f6', text: '<strong>Souveräne Clouds</strong> (AWS European, DELOS)' },
                { color: '#10b981', text: '<strong>Deutsche/EU Anbieter</strong> (STACKIT, IONOS, OTC)' },
                { color: '#8b5cf6', text: '<strong>Private Cloud</strong> (VMware, OpenStack)' },
                { color: '#f59e0b', text: '<strong>Hybrid-Lösungen</strong> (Outposts, Stack HCI, Dedicated)' }
            ],
            anonymous: [
                { color: '#ef4444', text: '<strong>Hyperscaler</strong> (H1, H2, H3, H4)' },
                { color: '#3b82f6', text: '<strong>Souveräne Clouds</strong> (S1, S2)' },
                { color: '#10b981', text: '<strong>Deutsche/EU Anbieter</strong> (E1, E2, E3)' },
                { color: '#8b5cf6', text: '<strong>Private Cloud</strong> (P1, P2)' },
                { color: '#f59e0b', text: '<strong>Hybrid-Lösungen</strong> (Y1, Y2, Y3)' }
            ]
        };

        let currentProviders = [];
        let isPublicAccess = false;
        let activeCategories = new Set(['hyperscaler', 'sovereign', 'eu', 'private', 'hybrid']);

        // Reload providers with custom scores
        function reloadProvidersWithCustomScores() {
            const updatedFullProviders = applyCustomScores(baseFullProviders);
            const updatedAnonymousProviders = updatedFullProviders.map((p, i) => {
                let prefix = '';
                if (p.category === 'hyperscaler') prefix = 'H';
                else if (p.category === 'sovereign') prefix = 'S';
                else if (p.category === 'eu') prefix = 'E';
                else if (p.category === 'private') prefix = 'P';
                else if (p.category === 'hybrid') prefix = 'Y';

                const index = baseFullProviders.filter((fp, fi) => fi <= i && fp.category === p.category).length;
                return { ...p, name: `${prefix}${index}` };
            });

            currentProviders = isPublicAccess ? updatedAnonymousProviders : updatedFullProviders;
            const slider = document.getElementById('strategySlider');
            updateVisualization(parseInt(slider.value));
        }

        // Listen for storage changes (when criteria page saves)
        window.addEventListener('storage', (e) => {
            if (e.key === 'scc_custom_provider_scores') {
                reloadProvidersWithCustomScores();
            }
        });

        // Initialize Compass
        function initializeCompass(isPublic) {
            isPublicAccess = isPublic;
            currentProviders = isPublic ? anonymousProviders : fullProviders;

            // Update Legend
            const legendGrid = document.getElementById('legendGrid');
            legendGrid.innerHTML = '';
            const legends = isPublic ? legendData.anonymous : legendData.full;

            legends.forEach(item => {
                const legendItem = document.createElement('div');
                legendItem.className = 'legend-item';
                legendItem.innerHTML = `
                    <div class="legend-dot" style="background: ${item.color};"></div>
                    <span class="legend-text">${item.text}</span>
                `;
                legendGrid.appendChild(legendItem);
            });

            // Initialize category filters
            initializeFilters();

            updateVisualization(50);
        }

        // Initialize Category Filters
        function initializeFilters() {
            const filterOptions = document.querySelectorAll('.filter-option');

            filterOptions.forEach(option => {
                option.addEventListener('click', () => {
                    const category = option.getAttribute('data-category');
                    const checkbox = option.querySelector('.filter-checkbox');

                    if (activeCategories.has(category)) {
                        activeCategories.delete(category);
                        checkbox.classList.remove('active');
                    } else {
                        activeCategories.add(category);
                        checkbox.classList.add('active');
                    }

                    // Re-render with current slider value
                    const slider = document.getElementById('strategySlider');
                    updateVisualization(parseInt(slider.value));
                });
            });
        }

        // Calculate Score
        function calculateScore(provider, weight) {
            const controlWeight = (100 - weight) / 100;
            const performanceWeight = weight / 100;
            return (provider.control * controlWeight) + (provider.performance * performanceWeight);
        }

        // Update Visualization
        function updateVisualization(sliderValue) {
            const controlWeight = 100 - sliderValue;
            const performanceWeight = sliderValue;

            // Update thumb position (optimized)
            const sliderThumb = document.getElementById('sliderThumb');
            sliderThumb.style.left = `${sliderValue}%`;

            // Update value display
            const valueDisplay = document.getElementById('valueDisplay');
            if (sliderValue < 20) {
                valueDisplay.textContent = `Kontrolle-fokussiert (${controlWeight}:${performanceWeight})`;
            } else if (sliderValue < 40) {
                valueDisplay.textContent = `Kontrolle-orientiert (${controlWeight}:${performanceWeight})`;
            } else if (sliderValue < 60) {
                valueDisplay.textContent = `Ausgewogen (${controlWeight}:${performanceWeight})`;
            } else if (sliderValue < 80) {
                valueDisplay.textContent = `Leistungs-orientiert (${controlWeight}:${performanceWeight})`;
            } else {
                valueDisplay.textContent = `Leistungs-fokussiert (${controlWeight}:${performanceWeight})`;
            }

            // Calculate scores (filter by active categories)
            const scoredProviders = currentProviders
                .filter(provider => activeCategories.has(provider.category))
                .map(provider => ({
                    ...provider,
                    score: calculateScore(provider, sliderValue)
                }))
                .sort((a, b) => b.score - a.score);

            // Update chart and results
            updateChart(scoredProviders);
            updateResults(scoredProviders);
        }

        // Update Chart (optimized)
        function updateChart(scoredProviders) {
            const chartCanvas = document.getElementById('chartCanvas');
            chartCanvas.querySelectorAll('.provider-point').forEach(point => point.remove());

            const fragment = document.createDocumentFragment();

            scoredProviders.forEach((provider, index) => {
                const point = document.createElement('div');
                point.className = 'provider-point';
                if (index === 0) point.classList.add('winner');

                let x = 10 + (provider.performance * 0.8);
                let y = 90 - (provider.control * 0.8);

                if (provider.groupIndex !== undefined) {
                    const offsetX = provider.groupIndex === 0 ? 1.5 : (provider.groupIndex === 1 ? 0 : -1.5);
                    const offsetY = (provider.groupIndex === 1) ? -0.8 : 0.4;
                    x += offsetX;
                    y += offsetY;
                }

                point.style.left = `${x}%`;
                point.style.top = `${y}%`;
                point.style.backgroundColor = provider.color;

                const size = index === 0 ? 36 : index <= 2 ? 32 : index <= 5 ? 28 : index <= 9 ? 24 : 20;
                point.style.width = `${size}px`;
                point.style.height = `${size}px`;
                point.style.zIndex = 50 - index;

                const tooltip = document.createElement('div');
                tooltip.className = 'provider-tooltip';
                tooltip.textContent = `${provider.name} (Score: ${provider.score.toFixed(1)})`;
                point.appendChild(tooltip);

                fragment.appendChild(point);
            });

            chartCanvas.appendChild(fragment);
        }

        // Update Results (optimized)
        function updateResults(scoredProviders) {
            const resultsGrid = document.getElementById('resultsGrid');
            resultsGrid.innerHTML = '';

            const topProviders = scoredProviders.slice(0, 8);
            const rankings = [];

            topProviders.forEach((provider, index) => {
                if (index === 0) {
                    rankings.push(1);
                } else {
                    rankings.push(Math.abs(provider.score - topProviders[index - 1].score) < 0.01
                        ? rankings[index - 1]
                        : index + 1);
                }
            });

            const fragment = document.createDocumentFragment();

            topProviders.forEach((provider, index) => {
                const card = document.createElement('div');
                card.className = 'result-card';
                if (rankings[index] === 1) card.classList.add('winner');

                card.innerHTML = `
                    <div class="result-rank">#${rankings[index]}</div>
                    <div class="result-name">${provider.name}</div>
                    <div class="result-description">${provider.description}</div>
                    <div class="result-metrics">
                        <span>Kontrolle: ${provider.control}</span>
                        <span>Leistung: ${provider.performance}</span>
                    </div>
                    <div class="result-score">Score: ${provider.score.toFixed(1)}</div>
                    <div class="score-bar">
                        <div class="score-fill" style="width: ${provider.score}%"></div>
                    </div>
                `;

                fragment.appendChild(card);
            });

            resultsGrid.appendChild(fragment);
        }

        // Event Listeners
        const slider = document.getElementById('strategySlider');
        let rafId = null;

        slider.addEventListener('input', (e) => {
            if (rafId) cancelAnimationFrame(rafId);
            rafId = requestAnimationFrame(() => {
                updateVisualization(parseInt(e.target.value));
            });
        });

        document.getElementById('passwordInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') checkPassword();
        });

        // Initialize
        window.addEventListener('load', checkSession);
    </script>
</body>
</html>
